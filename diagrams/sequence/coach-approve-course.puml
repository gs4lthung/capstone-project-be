@startuml coach-approve-course

title Coach Approve Course (Request Workflow)

actor Coach
actor Admin
participant "Coach App" as CoachApp
participant "Admin App" as AdminApp
participant "API Gateway" as API
participant "Course Controller" as CourseCtrl
participant "Course Service" as CourseSvc
participant "Request Controller" as RequestCtrl
participant "Request Service" as RequestSvc
participant "Notification Service" as NotifSvc
participant "Database" as DB

== Select Subject & Create Course ==
Coach -> CoachApp: Click "Create Course"
CoachApp -> API: GET /subjects (get list of coach's subjects)
API -> CoachApp: Subject list
Coach -> CoachApp: Select subject
CoachApp -> API: POST /courses/subjects/{subjectId}\n(CreateCourseRequestDto)
API -> CourseCtrl: createCourse(subjectId, courseData)
CourseCtrl -> CourseSvc: CreateCourse(subjectId, courseData)
CourseSvc -> DB: Create Course record\n(status=PENDING)
DB --> CourseSvc: Course created (courseId)
CourseSvc --> CourseCtrl: Course created
CourseCtrl --> API: Course data
API --> CoachApp: Course created successfully
CoachApp --> Coach: Show course in "My Courses"

== Update Course ==
Coach -> CoachApp: Edit course details
CoachApp -> API: PUT /courses/{courseId}\n(UpdateCourseDto, file?)
API -> CourseCtrl: updateCourseCreationRequest(courseId, data)
CourseCtrl -> CourseSvc: updateCourseCreationRequest(courseId, data, file)
CourseSvc -> DB: Update course request
DB --> CourseSvc: Course updated
CourseSvc --> CourseCtrl: Success
CourseCtrl --> API: Response
API --> CoachApp: Course updated
CoachApp --> Coach: "Changes saved"

== Admin Reviews Course ==
Admin -> AdminApp: View pending courses
AdminApp -> API: GET /courses (with status filter)
API -> CourseCtrl: Get courses
CourseCtrl -> CourseSvc: Get pending courses
CourseSvc -> DB: Query courses (status=PENDING)
DB --> CourseSvc: Course list
CourseSvc --> CourseCtrl: Courses
CourseCtrl --> API: Response
API --> AdminApp: Display pending courses
AdminApp --> Admin: Show list of courses waiting approval

Admin -> AdminApp: Click on course to review
AdminApp -> API: GET /courses/{courseId}
API -> CourseSvc: GetCourseDetails(courseId)
CourseSvc -> DB: Query course details
DB --> CourseSvc: Course data
CourseSvc --> API: Course details
API --> AdminApp: Course data
AdminApp --> Admin: Display course details

== Course Approval / Rejection ==
alt Admin Approves
    Admin -> AdminApp: Review course & click "Approve"
    AdminApp -> API: PATCH /courses/requests/:id/approve
    API -> CourseCtrl: approveCourseCreationRequest(courseId)
    CourseCtrl -> CourseSvc: approveCourseCreationRequest(courseId)
    CourseSvc -> DB: Update Course\n(status=APPROVED)
    DB --> CourseSvc: Course approved

    CourseSvc --> CourseCtrl: Success
    CourseCtrl --> API: Response
    API --> AdminApp: Course approved
    AdminApp --> Admin: Display "Course Approved"

else Admin Rejects
    Admin -> AdminApp: Review course & click "Reject"
    AdminApp -> API: PATCH /courses/requests/:id/reject\n(reason)
    API -> CourseCtrl: rejectCourseCreationRequest(courseId, reason)
    CourseCtrl -> CourseSvc: rejectCourseCreationRequest(courseId, reason)
    CourseSvc -> DB: Update Course\n(status=REJECTED, reason)
    DB --> CourseSvc: Course rejected

    CourseSvc --> CourseCtrl: Success
    CourseCtrl --> API: Response
    API --> AdminApp: Course rejected
    AdminApp --> Admin: Display rejection reason
end

@enduml
