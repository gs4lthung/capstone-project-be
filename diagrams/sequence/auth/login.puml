@startuml

actor "Guest" as guest
participant "Client" as client
participant "Auth\nController" as controller
participant "Auth\nService" as service
database "Database" as db

guest -> client: 1. Enter credentials
client -> controller: 2. POST /auth/login
activate controller

controller -> service: 3. login(email, password)
activate service

service -> db: 4. Find user
activate db
db --> service: User data
deactivate db

service -> service: 5. Verify password\nwith bcrypt

alt Invalid credentials
  service --> controller: Unauthorized\nerror
else Valid credentials
  service -> service: 6. Generate JWT tokens\n(access & refresh)
  service -> db: 7. Update user\n(token hash,\nlastLoginAt)
  activate db
  db --> service: Updated
  deactivate db
  
  service --> controller: LoginResponseDto\n{accessToken,\nrefreshToken, user}
end

deactivate service

controller --> client: 8. HTTP 200/401\nResponse
deactivate controller

client --> guest: 9. Show result

@enduml
