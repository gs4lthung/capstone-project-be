@startuml UpdateLesson

actor Coach
participant LessonController
participant AuthGuard
participant RoleGuard
participant LessonService
participant DataSource

Coach -> LessonController: PUT /lessons/:id
activate LessonController

LessonController -> AuthGuard: validate JWT
activate AuthGuard
AuthGuard --> LessonController: valid
deactivate AuthGuard

LessonController -> RoleGuard: check COACH role
activate RoleGuard
RoleGuard --> LessonController: authorized
deactivate RoleGuard

LessonController -> LessonService: update(id, data)
activate LessonService

LessonService -> DataSource: BEGIN TRANSACTION
activate DataSource

DataSource -> DataSource: find lesson with subject relations
DataSource -> DataSource: verify ownership (subject.createdBy == currentUser)
DataSource -> DataSource: update lesson
DataSource -> DataSource: COMMIT

DataSource --> LessonService: success
deactivate DataSource

LessonService --> LessonController: CustomApiResponse (OK)
deactivate LessonService

LessonController --> Coach: HTTP 200 updated
deactivate LessonController

@enduml
