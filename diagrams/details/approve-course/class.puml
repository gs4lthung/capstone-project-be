@startuml ApproveCourseClassDiagram
!theme plain
skinparam classBackgroundColor #f0f0f0
skinparam classBorderColor #333
skinparam arrowColor #333

' ════════════════════════════════════════════════════════════════════════════════════
' CONTROLLER LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class CourseController {

}

' ════════════════════════════════════════════════════════════════════════════════════
' SERVICE LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class CourseService {

}

class SessionService {

}

class NotificationService {

}

' ════════════════════════════════════════════════════════════════════════════════════
' ENTITY LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class Course {

}

class Request {

}

class RequestAction {

}

class Session {

}

class Subject {

}

class User {

}

' ════════════════════════════════════════════════════════════════════════════════════
' RELATIONSHIPS
' ════════════════════════════════════════════════════════════════════════════════════

CourseController --> CourseService: delegates

CourseService --> Course: reads/updates
CourseService --> Request: reads/updates
CourseService --> RequestAction: creates
CourseService --> SessionService: generates sessions
CourseService --> NotificationService: sends notifications

Course --> Subject: belongs to
Course --> Session: has many
Course --> User: created by
Request --> RequestAction: has many
RequestAction --> User: handled by

@enduml

class Session {
  -id: number
  -course: Course
  -lesson: Lesson
  -video: Video
  -quiz: Quiz
  -schedule: Date
}

class Subject {
  -id: number
  -name: string
  -lessons: Lesson[]
}

class Lesson {
  -id: number
  -name: string
  -subject: Subject
  -video?: Video
  -quiz?: Quiz
}

class Video {
  -id: number
  -url: string
  -status: CoachVideoStatus
  -lesson?: Lesson
  -session?: Session
}

class Quiz {
  -id: number
  -name: string
  -lesson?: Lesson
  -session?: Session
  -questions: Question[]
}

class User {
  -id: number
  -email: string
  -fullName: string
  -role: Role
}

class Role {
  -id: number
  -name: string (ADMIN)
}

' ════════════════════════════════════════════════════════════════════════════════════
' ENUMS
' ════════════════════════════════════════════════════════════════════════════════════

enum CourseStatus {
  PENDING_APPROVAL
  APPROVED
  REJECTED
  READY_OPENED
  FULL
  CANCELLED
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum RequestActionType {
  APPROVED
  REJECTED
  COMMENTED
}

' ════════════════════════════════════════════════════════════════════════════════════
' UTILITY SERVICES
' ════════════════════════════════════════════════════════════════════════════════════

class SessionService {
  --
  +generateSessionsFromSchedules(course, schedules): Promise<Session[]>
}

class NotificationService {
  --
  +sendNotification(data): Promise<void>
}

' ════════════════════════════════════════════════════════════════════════════════════
' SECURITY LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AuthGuard {
  --
  +canActivate(context): boolean
}

class RoleGuard {
  --
  +canActivate(context): boolean
  -checkAdminRole(user): boolean
}

' ════════════════════════════════════════════════════════════════════════════════════
' INFRASTRUCTURE
' ════════════════════════════════════════════════════════════════════════════════════

class DataSource {
  --
  +transaction(callback): Promise<Result>
}

' ════════════════════════════════════════════════════════════════════════════════════
' RELATIONSHIPS
' ════════════════════════════════════════════════════════════════════════════════════

CourseApprovalPanel --> CourseController: calls

CourseController --> CourseService: delegates
CourseController --> AuthGuard: validates
CourseController --> RoleGuard: checks admin

CourseService --> Course: reads/updates
CourseService --> Request: reads/updates
CourseService --> RequestAction: creates
CourseService --> Session: generates
CourseService --> User: tracks
CourseService --> SessionService: generates sessions
CourseService --> NotificationService: sends notifications
CourseService --> DataSource: transactions

Course --> Subject: has
Course --> Session: has_many
Course --> User: createdBy
Request --> RequestAction: has_many
RequestAction --> User: handledBy
Session --> Lesson: references
Session --> Video: references
Session --> Quiz: references
Subject --> Lesson: has_many
Lesson --> Video: has_one
Lesson --> Quiz: has_one
Course --> CourseStatus: has status
Request --> RequestStatus: has status

@enduml
