@startuml RegisterClassDiagram
!theme plain
skinparam classBackgroundColor #f0f0f0
skinparam classBorderColor #333
skinparam arrowColor #333

' ════════════════════════════════════════════════════════════════════════════════════
' PRESENTATION LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class RegisterScreen {
  -fullName: string
  -email: string
  -phoneNumber: string
  -password: string
  -province: number
  -district: number
  -skillLevel: string
  -learningGoal: string
  --
  +handleRegister(): void
  +handleEmailVerification(): void
  +handlePhoneVerification(): void
  +validateForm(): boolean
}

' ════════════════════════════════════════════════════════════════════════════════════
' CONTROLLER LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AuthController {
  -authService: AuthService
  --
  +register(data: RegisterRequestDto): Promise<Response>
  +verifyEmail(token: string): Promise<Response>
  +verifyPhone(data: VerifyPhoneDto): Promise<Response>
  ...
}

' ════════════════════════════════════════════════════════════════════════════════════
' SERVICE LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AuthService {
  -userRepository: Repository
  -jwtService: JwtService
  -mailService: MailService
  -twilioService: TwilioService
  -configService: ConfigService
  --
  +register(data: RegisterRequestDto): Promise<Response>
  +verifyEmail(token: string): Promise<string>
  +verifyPhone(data: VerifyPhoneDto): Promise<Response>
  -hashPassword(plain): Promise<string>
  -generateVerificationToken(userId): Promise<string>
  ...
}

' ════════════════════════════════════════════════════════════════════════════════════
' ENTITY LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class User {
  -id: number
  -fullName: string
  -email?: string
  -phoneNumber?: string
  -password: string
  -isEmailVerified: boolean
  -isPhoneVerified: boolean
  -isActive: boolean
  -emailVerificationToken?: string
  -role: Role
  -learner: Learner
  -wallet: Wallet
}

class Learner {
  -id: number
  -user: User
  -skillLevel: string
  -learningGoal: string
}

class Wallet {
  -id: number
  -user: User
  -currentBalance: number
}

class Role {
  -id: number
  -name: string
}

' ════════════════════════════════════════════════════════════════════════════════════
' UTILITY LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class JwtService {
  --
  +signAsync(payload): Promise<Token>
  +verifyAsync(token): Promise<Payload>
}

class MailService {
  --
  +sendMail(data): Promise<void>
}

class TwilioService {
  --
  +sendSMS(phoneNumber): Promise<void>
  +verifyPhoneNumber(phone, code): Promise<boolean>
}

class ConfigService {
  --
  +get(key: string): any
}

' ════════════════════════════════════════════════════════════════════════════════════
' RELATIONSHIPS
' ════════════════════════════════════════════════════════════════════════════════════

RegisterScreen --> AuthController: calls register()

AuthController --> AuthService: delegates

AuthService --> User: creates/updates
AuthService --> JwtService: generates tokens
AuthService --> MailService: sends emails
AuthService --> TwilioService: sends SMS
AuthService --> ConfigService: gets config

User --> Role: belongs to
User --> Learner: has_one
User --> Wallet: has_one

@enduml
