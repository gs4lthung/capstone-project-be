sequenceDiagram
    actor User
    participant controller as WalletController
    participant auth as AuthGuard
    participant service as WalletService
    participant db as DataSource

    User->>controller: POST /wallets
    activate controller

    controller->>auth: validate JWT
    activate auth
    auth-->>controller: valid
    deactivate auth

    controller->>service: create(CreateWalletDto)
    activate service

    service->>db: BEGIN TRANSACTION
    activate db

    db->>db: find bank by bankId
    db->>db: create new wallet
    db->>db: assign user, bank, bankAccountNumber
    db->>db: save wallet
    db->>db: COMMIT

    Note right of db: Create wallet with:<br/>- userId from auth context<br/>- bankId from DTO<br/>- bankAccountNumber from DTO<br/>- currentBalance default 0<br/>- totalIncome default 0

    db-->>service: success
    deactivate db

    service-->>controller: CustomApiResponse (201)
    deactivate service

    controller-->>User: HTTP 201 Created
    deactivate controller
