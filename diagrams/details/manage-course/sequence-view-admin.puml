@startuml ViewCourseAdminSequence

actor "Admin" as admin
participant "CourseController" as controller
participant "AuthGuard" as authGuard
participant "RoleGuard" as roleGuard
participant "CourseService" as service
participant "CourseRepository" as courseRepo
database "DataSource" as db

== View All Courses (Admin) ==

admin -> controller: GET /courses?page=1&size=10\n&pagination&sort&filter
activate controller

controller -> authGuard: canActivate(context)
activate authGuard
authGuard --> controller: true (authenticated)
deactivate authGuard

controller -> roleGuard: canActivate(context)
activate roleGuard
roleGuard --> controller: true (ADMIN role)
deactivate roleGuard

controller -> service: findAll(findOptions)
activate service

service -> courseRepo: find(findOptions)
activate courseRepo

courseRepo -> db: SELECT courses with pagination\nsort and filter
activate db
db --> courseRepo: Course records
deactivate db

courseRepo --> service: PaginateObject<Course>
deactivate courseRepo

service --> controller: PaginateObject<Course>
deactivate service

controller --> admin: HTTP 200 PaginateObject<Course>
deactivate controller

== View Single Course Details ==

admin -> controller: GET /courses/:id
activate controller

controller -> service: findOne(id)
activate service

service -> db: transaction
activate db

db -> db: SELECT course with relations\n(sessions, createdBy, quiz, video,\nenrollments, user, subject,\nschedules, court, province, district)

db --> service: Course with full relations
deactivate db

service --> controller: Course
deactivate service

controller --> admin: HTTP 200 Course
deactivate controller

@enduml
