@startuml ManageSubjectRestoreDiagram

actor Coach
participant AuthGuard
participant RoleGuard
participant SubjectController
participant SubjectService
database DataSource

== View Deleted Subjects ==

Coach -> SubjectController: GET /subjects?withDeleted=true
activate SubjectController

SubjectController -> AuthGuard: validate token
activate AuthGuard
AuthGuard --> SubjectController: valid
deactivate AuthGuard

SubjectController -> RoleGuard: check COACH role
activate RoleGuard
RoleGuard --> SubjectController: authorized
deactivate RoleGuard

SubjectController -> SubjectService: findAll(options)
activate SubjectService

SubjectService -> DataSource: SELECT subjects including deleted
activate DataSource
DataSource --> SubjectService: deleted subjects
deactivate DataSource

SubjectService --> SubjectController: results
deactivate SubjectService

SubjectController --> Coach: 200 OK
deactivate SubjectController

== Restore Subject ==

Coach -> SubjectController: PATCH /subjects/:id/restore
activate SubjectController

SubjectController -> AuthGuard: validate token
activate AuthGuard
AuthGuard --> SubjectController: valid
deactivate AuthGuard

SubjectController -> RoleGuard: check COACH role
activate RoleGuard
RoleGuard --> SubjectController: authorized
deactivate RoleGuard

SubjectController -> SubjectService: restore(id)
activate SubjectService

SubjectService -> DataSource: SELECT subject with deleted
activate DataSource
DataSource --> SubjectService: deleted subject found
deactivate DataSource

SubjectService -> SubjectService: verify ownership

SubjectService -> DataSource: UPDATE subject SET deletedAt = NULL
activate DataSource
DataSource --> SubjectService: restored
deactivate DataSource

SubjectService --> SubjectController: success
deactivate SubjectService

SubjectController --> Coach: 200 OK
deactivate SubjectController

@enduml
