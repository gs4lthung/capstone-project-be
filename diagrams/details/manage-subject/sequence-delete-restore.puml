@startuml ManageSubjectDeleteRestoreDiagram

actor "Coach" as coach
participant "Client" as client
participant "Controller" as controller
participant "Service" as service
database "Database" as db

== Delete Subject ==

coach -> client: 1. View subject details
client --> coach: 2. Display subject with "Delete" button

coach -> client: 3. Click "Delete Subject"
client --> coach: 4. Show confirmation dialog

coach -> client: 5. Confirm deletion
client -> controller: 6. DELETE /subjects/:id
activate controller

controller -> service: 7. delete(id)
activate service

service -> db: 8. Find subject by id
activate db
db --> service: Subject found
deactivate db

service -> service: 9. Verify ownership (createdBy == currentUser)
note right of service
  If not owner, throw ForbiddenException
end note

service -> db: 10. Soft delete subject (set deletedAt)
activate db
db --> service: Deleted
deactivate db

service --> controller: Success response
deactivate service

controller --> client: 11. HTTP 200
deactivate controller

client --> coach: 12. Subject deleted successfully

coach -> client: 13. Navigate to deleted subjects
client -> controller: 14. GET /subjects?withDeleted=true
activate controller

controller -> service: 15. findAll(options)
activate service

service -> db: 16. Query subjects including soft-deleted
activate db
db --> service: Deleted subjects list
deactivate db

service --> controller: Response
deactivate service

controller --> client: 17. HTTP 200
deactivate controller

client --> coach: 18. Display deleted subjects

== Restore Subject ==

coach -> client: 19. Click "Restore" on deleted subject
client --> coach: 20. Show restore confirmation

coach -> client: 21. Confirm restore
client -> controller: 22. PATCH /subjects/:id/restore
activate controller

controller -> service: 23. restore(id)
activate service

service -> db: 24. Find deleted subject (withDeleted=true)
activate db
db --> service: Deleted subject found
deactivate db

service -> db: 25. Restore subject (clear deletedAt)
activate db
db --> service: Restored
deactivate db

service --> controller: Success response
deactivate service

controller --> client: 26. HTTP 200
deactivate controller

client --> coach: 27. Subject restored successfully

coach -> client: 28. Navigate back to subjects list
client --> coach: 29. Subject now appears in active list

@enduml
