@startuml UpdateCoachProfileClassDiagram
!theme plain
skinparam classBackgroundColor #f0f0f0
skinparam classBorderColor #333
skinparam arrowColor #333

' ════════════════════════════════════════════════════════════════════════════════════
' PRESENTATION LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class CoachListPanel {
  -coaches: Coach[]
  -filters: FilterCriteria
  -pagination: Pagination
  --
  +loadCoaches(): void
  +applyFilters(criteria): void
  +searchCoaches(query): void
  +sortCoaches(field): void
  +selectCoach(id): void
  +displayList(): void
}

class CoachProfileCard {
  -coach: Coach
  -isOwnProfile: boolean
  -rating: Rating
  -courses: Course[]
  --
  +loadProfileData(): void
  +displayBasicInfo(): void
  +displayRating(): void
  +displayCredentials(): void
  +displayCourses(): void
  +showEditButton(): void
  +contactCoach(): void
}

class CoachProfileEditForm {
  -coach: Coach
  -formData: UpdateCoachProfileDto
  --
  +loadProfile(): void
  +populateForm(): void
  +updateFields(data): void
  +submitUpdate(): void
  +displaySuccess(): void
}

class CredentialUploadPanel {
  -credentials: Credential[]
  -selectedFile: File
  --
  +loadCredentials(): void
  +selectFile(): void
  +fillCredentialForm(): void
  +uploadCredential(): void
  +displayUploadStatus(): void
  +deleteCredential(id): void
  +restoreCredential(id): void
}

' ════════════════════════════════════════════════════════════════════════════════════
' CONTROLLER LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class CoachController {
  -coachService: CoachService
  --
  +findAll(pagination, sort, filter): Promise<Response>
  +findOne(id): Promise<Coach>
  +update(data): Promise<Response>
  +getOverallRating(id): Promise<RatingResponse>
  +uploadCredential(data, file): Promise<Response>
  +updateCredential(id, data, file): Promise<Response>
  ...
}

' ════════════════════════════════════════════════════════════════════════════════════
' SERVICE LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class CoachService {
  -coachRepository: Repository
  -credentialRepository: Repository
  -feedbackRepository: Repository
  -bunnyService: BunnyService
  -datasource: DataSource
  --
  +findAll(findOptions): Promise<Coach[]>
  +findOne(id): Promise<Coach>
  +update(data): Promise<void>
  +getOverallRating(id): Promise<RatingResponse>
  +uploadCredential(data, file): Promise<void>
  +updateCredential(id, data, file): Promise<void>
  ...
}

' ════════════════════════════════════════════════════════════════════════════════════
' ENTITY LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class Coach {
  -id: number
  -bio: string
  -specialties: string[]
  -teachingMethods: string[]
  -yearOfExperience: number
  -verificationStatus: CoachVerificationStatus
  -verificationReason?: string
  -createdAt: Date
  -updatedAt: Date
  -user: User
  -credentials: Credential[]
}

class User {
  -id: number
  -fullName: string
  -email?: string
  -phoneNumber?: string
  -profilePicture?: string
  -isEmailVerified: boolean
  -isPhoneVerified: boolean
  -isActive: boolean
  -lastLoginAt?: Date
  -role: Role
  -coach: Coach[]
  -courses: Course[]
  -enrollments: Enrollment[]
}

class Credential {
  -id: number
  -name: string
  -description?: string
  -type: CourseCredentialType
  -publicUrl?: string
  -issuedAt?: Date
  -expiresAt?: Date
  -coach: Coach
  -createdAt: Date
  -updatedAt: Date
  -deletedAt?: Date
}

class Role {
  -id: number
  -name: string (COACH, LEARNER, ADMIN)
}

class Feedback {
  -id: number
  -rating: number (1-5)
  -comment: string
  -createdAt: Date
  -createdBy: User (Learner)
  -receivedBy: User (Coach)
}

' ════════════════════════════════════════════════════════════════════════════════════
' DTOs (INPUT/UPDATE)
' ════════════════════════════════════════════════════════════════════════════════════

class UpdateCoachProfileDto {
  +bio?: string
  +specialties?: string[]
  +teachingMethods?: string[]
  +yearOfExperience?: number
}

class UpdateCredentialDto {
  +name?: string
  +description?: string
  +type?: CourseCredentialType
  +publicUrl?: string
  +issuedAt?: Date
  +expiresAt?: Date
}

class RegisterCoachCredentialDto {
  +name: string
  +description?: string
  +type: CourseCredentialType
  +publicUrl?: string
  +issuedAt?: Date
  +expiresAt?: Date
}

' ════════════════════════════════════════════════════════════════════════════════════
' ENUMS & RESPONSES
' ════════════════════════════════════════════════════════════════════════════════════

enum CoachVerificationStatus {
  UNVERIFIED
  VERIFIED
  REJECTED
}

enum CourseCredentialType {
  CERTIFICATION
  LICENSE
  BADGE
  DIPLOMA
}

class RatingResponse {
  +overall: number (0-5)
  +total: number (feedback count)
}

' ════════════════════════════════════════════════════════════════════════════════════
' UTILITY SERVICES
' ════════════════════════════════════════════════════════════════════════════════════

class BunnyService {
  --
  +uploadToStorage(data): Promise<string>
}

' ════════════════════════════════════════════════════════════════════════════════════
' SECURITY LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AuthGuard {
  --
  +canActivate(context): boolean
}

class RoleGuard {
  --
  +canActivate(context): boolean
}

' ════════════════════════════════════════════════════════════════════════════════════
' RELATIONSHIPS
' ════════════════════════════════════════════════════════════════════════════════════

CoachListPanel --> CoachController: calls findAll
CoachListPanel --> CoachProfileCard: displays selected

CoachProfileCard --> CoachController: calls findOne
CoachProfileCard --> CoachController: calls getOverallRating
CoachProfileCard --> CoachProfileEditForm: navigates if own

CoachProfileEditForm --> CoachController: calls update
CredentialUploadPanel --> CoachController: calls uploadCredential, updateCredential

CoachController --> CoachService: delegates
CoachController --> AuthGuard: validates
CoachController --> RoleGuard: checks

CoachService --> Coach: queries/updates
CoachService --> Credential: creates/updates
CoachService --> Feedback: aggregates for rating
CoachService --> BunnyService: uploads credentials

Coach --> User: has_one
Coach --> Credential: has_many
Coach --> CoachVerificationStatus: has status

User --> Role: has_one
User --> Feedback: receives

Feedback --> User: createdBy

UpdateCoachProfileDto --> Coach: maps to
UpdateCredentialDto --> Credential: maps to
RegisterCoachCredentialDto --> Credential: maps to

@enduml
