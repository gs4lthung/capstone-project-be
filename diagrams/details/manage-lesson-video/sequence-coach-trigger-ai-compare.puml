@startuml CoachTriggerAiCompare
 
actor Coach
participant Client
participant LearnerVideoController
participant Auth
participant Role
participant LearnerVideoService

participant AiVideoCompareService
participant NotificationService
participant DataSource

== Coach Triggers AI Video Comparison ==

Coach -> Client: 1. Select learner video and click "Compare with AI"
Client -> LearnerVideoController: 2. POST /learner-videos/:id/compare
activate LearnerVideoController
LearnerVideoController -> Auth: 3. validate JWT
activate Auth
Auth --> LearnerVideoController: 4. valid
deactivate Auth
LearnerVideoController -> Role: 5. check COACH role
activate Role
Role --> LearnerVideoController: 6. authorized
deactivate Role
LearnerVideoController -> LearnerVideoService: 7. triggerAiComparison(learnerVideoId)
activate LearnerVideoService
LearnerVideoService -> DataSource: 8. fetch learner video and related coach video
activate DataSource
DataSource --> LearnerVideoService: 9. video entities
deactivate DataSource

LearnerVideoService -> AiVideoCompareService: 10. compare(learnerVideo, coachVideo)
activate AiVideoCompareService
AiVideoCompareService -> AiVideoCompareService: 11. build details array from comparison
AiVideoCompareService -> DataSource: 12. save AI feedback, summary, notes, scores, key differences, recommendations
activate DataSource
DataSource --> AiVideoCompareService: 13. saved AI comparison result
deactivate DataSource
AiVideoCompareService -> NotificationService: 14. send notification to learner
activate NotificationService
NotificationService --> AiVideoCompareService: 15. notification sent
deactivate NotificationService
AiVideoCompareService --> LearnerVideoService: 16. comparison result with feedback and notes
deactivate AiVideoCompareService
LearnerVideoService --> LearnerVideoController: 17. comparison result
deactivate LearnerVideoService
LearnerVideoController --> Client: 18. HTTP 200 OK (comparison result)
deactivate LearnerVideoController
Client --> Coach: 19. Show AI comparison result and notes
@enduml
