@startuml DeleteLessonVideo

actor Coach
participant VideoController
participant AuthGuard
participant RoleGuard
participant VideoService
participant DataSource

Coach -> VideoController: DELETE /videos/:id
activate VideoController

VideoController -> AuthGuard: validate JWT
activate AuthGuard
AuthGuard --> VideoController: valid
deactivate AuthGuard

VideoController -> RoleGuard: check COACH role
activate RoleGuard
RoleGuard --> VideoController: authorized
deactivate RoleGuard

VideoController -> VideoService: deleteVideo(id)
activate VideoService

VideoService -> DataSource: BEGIN TRANSACTION
activate DataSource

DataSource -> DataSource: find video with lesson/subject relations
DataSource -> DataSource: verify is lesson video (not session video)
DataSource -> DataSource: verify ownership (subject.createdBy == currentUser)
DataSource -> DataSource: soft delete video (set deletedAt)
DataSource -> DataSource: COMMIT

DataSource --> VideoService: success
deactivate DataSource

VideoService --> VideoController: CustomApiResponse (OK)
deactivate VideoService

VideoController --> Coach: HTTP 200 deleted
deactivate VideoController

@enduml
