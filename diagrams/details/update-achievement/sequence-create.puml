@startuml CreateAchievementSequence

actor "Admin" as admin
participant "AchievementController" as controller
participant "AuthGuard" as authGuard
participant "RoleGuard" as roleGuard
participant "AchievementService" as service
participant "BunnyService" as bunny
database "DataSource" as db

== Create Event Count Achievement ==

admin -> controller: POST /achievements/event-count\n(CreateEventCountAchievementDto, icon)
activate controller

controller -> authGuard: canActivate
authGuard --> controller: authenticated

controller -> roleGuard: canActivate
roleGuard --> controller: ADMIN role

controller -> service: createEventCount(data, icon)
activate service

alt icon file provided
    service -> bunny: uploadToStorage(icon)
    activate bunny
    bunny --> service: iconUrl
    deactivate bunny
end

service -> db: INSERT event count achievement
activate db
db --> service: Achievement
deactivate db

service --> controller: CustomApiResponse(success)
deactivate service

controller --> admin: HTTP 201 {message}
deactivate controller

== Create Streak Achievement ==

admin -> controller: POST /achievements/streak\n(CreateStreakAchievementDto, icon)
activate controller

controller -> authGuard: canActivate
authGuard --> controller: authenticated

controller -> roleGuard: canActivate
roleGuard --> controller: ADMIN role

controller -> service: createStreak(data, icon)
activate service

alt icon file provided
    service -> bunny: uploadToStorage(icon)
    activate bunny
    bunny --> service: iconUrl
    deactivate bunny
end

service -> db: INSERT streak achievement
activate db
db --> service: Achievement
deactivate db

service --> controller: CustomApiResponse(success)
deactivate service

controller --> admin: HTTP 201 {message}
deactivate controller

== Create Property Check Achievement ==

admin -> controller: POST /achievements/property-check\n(CreatePropertyCheckAchievementDto, icon)
activate controller

controller -> authGuard: canActivate
authGuard --> controller: authenticated

controller -> roleGuard: canActivate
roleGuard --> controller: ADMIN role

controller -> service: createPropertyCheck(data, icon)
activate service

alt icon file provided
    service -> bunny: uploadToStorage(icon)
    activate bunny
    bunny --> service: iconUrl
    deactivate bunny
end

service -> db: INSERT property check achievement
activate db
db --> service: Achievement
deactivate db

service --> controller: CustomApiResponse(success)
deactivate service

controller --> admin: HTTP 201 {message}
deactivate controller

@enduml
