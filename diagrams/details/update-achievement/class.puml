@startuml UpdateAchievementClassDiagram
!theme plain
skinparam classBackgroundColor #f0f0f0
skinparam classBorderColor #333
skinparam arrowColor #333

left to right direction

' ════════════════════════════════════════════════════════════════════════════════════
' CONTROLLER LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AchievementController {

}

' ════════════════════════════════════════════════════════════════════════════════════
' GUARD LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AuthGuard {

}

class RoleGuard {

}

' ════════════════════════════════════════════════════════════════════════════════════
' DTO LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class CreateEventCountAchievementDto {

}

class CreateStreakAchievementDto {

}

class CreatePropertyCheckAchievementDto {

}

class UpdateEventCountAchievementDto {

}

class UpdateStreakAchievementDto {

}

class UpdatePropertyCheckAchievementDto {

}

' ════════════════════════════════════════════════════════════════════════════════════
' SERVICE LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AchievementService {

}

class BunnyService {

}

' ════════════════════════════════════════════════════════════════════════════════════
' ENTITY LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class Achievement {

}

class EventCountAchievement {

}

class StreakAchievement {

}

class PropertyCheckAchievement {

}

class LearnerProgress {

}

class User {

}

' ════════════════════════════════════════════════════════════════════════════════════
' RELATIONSHIPS
' ════════════════════════════════════════════════════════════════════════════════════

' Controller relationships
AchievementController --> AuthGuard: validates
AchievementController --> RoleGuard: checks role
AchievementController --> AchievementService: uses
AchievementController --> CreateEventCountAchievementDto: receives
AchievementController --> CreateStreakAchievementDto: receives
AchievementController --> CreatePropertyCheckAchievementDto: receives
AchievementController --> UpdateEventCountAchievementDto: receives
AchievementController --> UpdateStreakAchievementDto: receives
AchievementController --> UpdatePropertyCheckAchievementDto: receives

' Service relationships
AchievementService --> BunnyService: uses
AchievementService --> Achievement: manages
AchievementService --> EventCountAchievement: manages
AchievementService --> StreakAchievement: manages
AchievementService --> PropertyCheckAchievement: manages
AchievementService --> LearnerProgress: validates

' Entity relationships
EventCountAchievement --|> Achievement: extends
StreakAchievement --|> Achievement: extends
PropertyCheckAchievement --|> Achievement: extends

LearnerProgress --> Achievement: tracks
LearnerProgress --> User: belongs to

@enduml
  --
  +canActivate(context): boolean
}

class RoleGuard {
  --
  +canActivate(context): boolean
  -checkAdminRole(user): boolean
}

' ════════════════════════════════════════════════════════════════════════════════════
' RELATIONSHIPS
' ════════════════════════════════════════════════════════════════════════════════════

AchievementEditPanel --> AchievementController: calls

AchievementController --> AchievementService: delegates
AchievementController --> AuthGuard: validates
AchievementController --> RoleGuard: checks admin

AchievementService --> EventCountAchievement: updates
AchievementService --> StreakAchievement: updates
' Entity relationships
EventCountAchievement --|> Achievement: extends
StreakAchievement --|> Achievement: extends
PropertyCheckAchievement --|> Achievement: extends

LearnerProgress --> Achievement: tracks
LearnerProgress --> User: belongs to

@enduml
