@startuml UpdateAchievementClassDiagram
!theme plain
skinparam classBackgroundColor #f0f0f0
skinparam classBorderColor #333
skinparam arrowColor #333

' ════════════════════════════════════════════════════════════════════════════════════
' PRESENTATION LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AchievementEditPanel {
  -achievementId: number
  -achievementData: Achievement
  -selectedFile: File
  --
  +loadAchievementDetails(): void
  +populateForm(): void
  +updateFields(data): void
  +selectIcon(): void
  +submitUpdate(): void
  +displayMessage(status): void
}

' ════════════════════════════════════════════════════════════════════════════════════
' CONTROLLER LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AchievementController {
  -achievementService: AchievementService
  --
  +updateEventCount(id, data, icon): Promise<Response>
  +updateStreak(id, data, icon): Promise<Response>
  +updatePropertyCheck(id, data, icon): Promise<Response>
}

' ════════════════════════════════════════════════════════════════════════════════════
' SERVICE LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AchievementService {
  -eventCountRepository: Repository
  -streakRepository: Repository
  -propertyCheckRepository: Repository
  -bunnyService: BunnyService
  --
  +updateEventCount(id, data, icon?): Promise<void>
  +updateStreak(id, data, icon?): Promise<void>
  +updatePropertyCheck(id, data, icon?): Promise<void>
  ...
}

' ════════════════════════════════════════════════════════════════════════════════════
' ENTITY LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class Achievement {
  -id: number
  -name: string
  -description?: string
  -iconUrl?: string
  -isActive: boolean
  -createdAt: Date
  -createdBy: User
}

class EventCountAchievement {
  -id: number
  -name: string
  -description?: string
  -iconUrl?: string
  -isActive: boolean
  -eventName: string
  -targetCount: number
  -createdBy: User
}

class StreakAchievement {
  -id: number
  -name: string
  -description?: string
  -iconUrl?: string
  -isActive: boolean
  -eventName: string
  -targetStreakLength: number
  -streakUnit: string (days|weeks|months)
  -createdBy: User
}

class PropertyCheckAchievement {
  -id: number
  -name: string
  -description?: string
  -iconUrl?: string
  -isActive: boolean
  -eventName: string
  -entityName: string
  -propertyName: string
  -comparisonOperator: string (==|!=|>|<|>=|<=)
  -targetValue: string
  -createdBy: User
}

class User {
  -id: number
  -email: string
  -fullName: string
  -role: Role
  -achievements: Achievement[]
}

class Role {
  -id: number
  -name: string (ADMIN)
}

' ════════════════════════════════════════════════════════════════════════════════════
' DTOs (UPDATE)
' ════════════════════════════════════════════════════════════════════════════════════

class UpdateEventCountAchievementDto {
  +name?: string
  +description?: string
  +iconUrl?: string
  +eventName?: string
  +targetCount?: number
  +isActive?: boolean
}

class UpdateStreakAchievementDto {
  +name?: string
  +description?: string
  +iconUrl?: string
  +eventName?: string
  +targetStreakLength?: number
  +streakUnit?: string
  +isActive?: boolean
}

class UpdatePropertyCheckAchievementDto {
  +name?: string
  +description?: string
  +iconUrl?: string
  +eventName?: string
  +entityName?: string
  +propertyName?: string
  +comparisonOperator?: string
  +targetValue?: string
  +isActive?: boolean
}

' ════════════════════════════════════════════════════════════════════════════════════
' UTILITY SERVICES
' ════════════════════════════════════════════════════════════════════════════════════

class BunnyService {
  --
  +uploadToStorage(data): Promise<string>
}

' ════════════════════════════════════════════════════════════════════════════════════
' SECURITY LAYER
' ════════════════════════════════════════════════════════════════════════════════════

class AuthGuard {
  --
  +canActivate(context): boolean
}

class RoleGuard {
  --
  +canActivate(context): boolean
  -checkAdminRole(user): boolean
}

' ════════════════════════════════════════════════════════════════════════════════════
' RELATIONSHIPS
' ════════════════════════════════════════════════════════════════════════════════════

AchievementEditPanel --> AchievementController: calls

AchievementController --> AchievementService: delegates
AchievementController --> AuthGuard: validates
AchievementController --> RoleGuard: checks admin

AchievementService --> EventCountAchievement: updates
AchievementService --> StreakAchievement: updates
AchievementService --> PropertyCheckAchievement: updates
AchievementService --> BunnyService: uploads icon

Achievement <|-- EventCountAchievement: extends
Achievement <|-- StreakAchievement: extends
Achievement <|-- PropertyCheckAchievement: extends

Achievement --> User: createdBy

UpdateEventCountAchievementDto --> EventCountAchievement: maps to
UpdateStreakAchievementDto --> StreakAchievement: maps to
UpdatePropertyCheckAchievementDto --> PropertyCheckAchievement: maps to

@enduml
