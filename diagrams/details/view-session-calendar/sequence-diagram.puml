@startuml ViewSessionCalendarSequenceDiagram

actor User
participant SessionController
participant AuthGuard
participant RoleGuard
participant SessionService
participant DataSource

== View Sessions by Course ==

User -> SessionController: GET /sessions/courses/:id
activate SessionController

SessionController -> AuthGuard: validate JWT
activate AuthGuard
AuthGuard --> SessionController: valid
deactivate AuthGuard

SessionController -> RoleGuard: check COACH/LEARNER role
activate RoleGuard
RoleGuard --> SessionController: authorized
deactivate RoleGuard

SessionController -> SessionService: findByCourseId(courseId)
activate SessionService

SessionService -> DataSource: query sessions by course with relations
activate DataSource
DataSource --> SessionService: sessions list
deactivate DataSource

SessionService --> SessionController: sessions data
deactivate SessionService

SessionController --> User: HTTP 200 with sessions
deactivate SessionController

== View Weekly Calendar ==

User -> SessionController: GET /sessions/calendar/weekly?startDate&endDate
activate SessionController

SessionController -> AuthGuard: validate JWT
activate AuthGuard
AuthGuard --> SessionController: valid
deactivate AuthGuard

SessionController -> RoleGuard: check COACH/LEARNER role
activate RoleGuard
RoleGuard --> SessionController: authorized
deactivate RoleGuard

SessionController -> SessionService: getSessionsForWeeklyCalendar(data)
activate SessionService

SessionService -> DataSource: query sessions by date range and user
activate DataSource

note right of DataSource
  Filter by startDate, endDate
  Optionally filter by userId
end note

DataSource --> SessionService: filtered sessions
deactivate DataSource

SessionService --> SessionController: weekly sessions
deactivate SessionService

SessionController --> User: HTTP 200 with calendar data
deactivate SessionController

@enduml
